(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["cb22"],{cb22:function(s,a,t){"use strict";t.r(a);var r=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},l=[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("h2",[s._v("接口请求概述")]),t("p",[s._v("为了更加方便的调用接口，kiwi-ui对axios进行了封装，使接口调用更加简单方便，同时拥有一些非常实用的特性，如"),t("code",{pre:!0},[s._v("统一错误提示")]),s._v("、"),t("code",{pre:!0},[s._v("友好异常日志")]),s._v("。")]),t("h2",[s._v("接口报文约定")]),t("p",[t("code",{pre:!0},[s._v("code")]),s._v("为接口返回码，只有"),t("code",{pre:!0},[s._v("0")]),s._v("表示成功，"),t("code",{pre:!0},[s._v("message")]),s._v("为描述信息，"),t("code",{pre:!0},[s._v("data")]),s._v("为具体数据。")]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-json"}},[s._v("// 成功\n{\n  code: "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n  message: '成功',\n  data: {\n    erp: 'admin',\n    name: '超级管理员'\n  }\n}\n// 失败\n{\n  code: "),t("span",{attrs:{class:"hljs-number"}},[s._v("404")]),s._v(",\n  message: '接口地址不存在',\n  data: "),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v("\n}\n")])]),t("h2",[s._v("如何使用")]),t("p",[s._v("引入util工具")]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" * "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("as")]),s._v(" util "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" "),t("span",{attrs:{class:"hljs-string"}},[s._v("'@/libs/util'")]),s._v("\n")])]),t("p",[s._v("发送get请求")]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{attrs:{class:"hljs-comment"}},[s._v("// 发送get请求")]),s._v("\nutil.requestJson("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/config'")]),s._v(").then("),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{attrs:{class:"hljs-string"}},[s._v("'接口返回:'")]),s._v(", r))\n"),t("span",{attrs:{class:"hljs-comment"}},[s._v("// requestJson方法本质返回的是一个Promise对象，因此推荐使用async、await处理回调，代码更加清晰")]),s._v("\n"),t("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" r = "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" util.requestJson("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/config'")]),s._v(")\n"),t("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{attrs:{class:"hljs-string"}},[s._v("'接口返回:'")]),s._v(", r)\n")])]),t("p",[s._v("发送get请求，带参数")]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" r = "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" util.requestJson("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/user'")]),s._v(", {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("params")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("erp")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v("'xiongzhao1'")]),s._v("}})\n"),t("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{attrs:{class:"hljs-string"}},[s._v("'接口返回:'")]),s._v(", r)\n")])]),t("p",[s._v("发送post请求")]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" r = "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" util.requestJson("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/user'")]),s._v(", {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("erp")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v("'xiongzhao1'")]),s._v("}})\n"),t("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{attrs:{class:"hljs-string"}},[s._v("'接口返回:'")]),s._v(", r)\n")])]),t("p",[t("code",{pre:!0},[s._v("requestJson")]),s._v("发送请求时的请求头是: "),t("code",{pre:!0},[s._v("application/json")]),s._v(", 如果希望按照表单方式提交，需要使用"),t("code",{pre:!0},[s._v("requestForm")]),s._v("方法")]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" r = "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" util.requestForm("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/user'")]),s._v(", {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("erp")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v("'xiongzhao1'")]),s._v("}})\n"),t("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{attrs:{class:"hljs-string"}},[s._v("'接口返回:'")]),s._v(", r)\n")])]),t("h2",[s._v("统一错误提示")]),t("ul",[t("li",[s._v("发送Date类型的字段不需要手动转'yyyy-MM-dd HH:mm:ss'格式，接口请求工具会在发送请求前自动转格式。")]),t("li",[s._v("如果后端返回的"),t("code",{pre:!0},[s._v("code")]),s._v("码不为"),t("code",{pre:!0},[s._v("0")]),s._v("，接口请求工具包会自动调用"),t("code",{pre:!0},[s._v("iview")]),s._v("的"),t("code",{pre:!0},[s._v("Message")]),s._v("组件，对后端返回的"),t("code",{pre:!0},[s._v("message")]),s._v("内容进行统一错误提示，这一切对使用者透明。")]),t("li",[s._v("业务代码中不需要再判断"),t("code",{pre:!0},[s._v("code")]),s._v("是否为"),t("code",{pre:!0},[s._v("0")]),s._v("，也不需要手动进行错误提示。")]),t("li",[s._v("特别的，当我们需要在接口调用正确的前提下，去执行后续的一些操作时，并不需要在业务代码中判断"),t("code",{pre:!0},[s._v("code")]),s._v("是否为"),t("code",{pre:!0},[s._v("0")]),s._v("，直接写逻辑即可，这是因为在接口请求方法内部自动进行了判断，如果"),t("code",{pre:!0},[s._v("code")]),s._v("不为"),t("code",{pre:!0},[s._v("0")]),s._v("，会抛出异常，业务会被中断。")])]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" r = "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" util.requestForm("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/user'")]),s._v(", {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("erp")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v("'xiongzhao1'")]),s._v("}})\n"),t("span",{attrs:{class:"hljs-comment"}},[s._v("// 传统做法(不推荐这么写)")]),s._v("\n"),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (r.code === "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(") {\n  "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".user = r.data\n}\n"),t("span",{attrs:{class:"hljs-comment"}},[s._v("// 不需要判断code码，如果code不为0，程序会被异常中断，下面的语句不会被执行")]),s._v("\n"),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".user = r.data\n")])]),t("ul",[t("li",[s._v("当然，如果你需要对异常业务进行处理，可以通过Promise或catch来实现")])]),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-javascript"}},[t("span",{attrs:{class:"hljs-comment"}},[s._v("// Promise异常处理")]),s._v("\nutil.requestForm("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/user'")]),s._v(", {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("erp")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v("'xiongzhao1'")]),s._v("}})\n  .then("),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".user = r.data, err => "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".handleErr(err))\n"),t("span",{attrs:{class:"hljs-comment"}},[s._v("// catch异常处理")]),s._v("\nutil.requestForm("),t("span",{attrs:{class:"hljs-string"}},[s._v("'/api/user'")]),s._v(", {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("erp")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v("'xiongzhao1'")]),s._v("}})\n  .then("),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".user = r.data)\n  .catch("),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-params"}},[s._v("err")]),s._v(" =>")]),s._v(" "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".handleErr(err))\n")])])])}],v=t("2877"),e={},n=Object(v["a"])(e,r,l,!1,null,null,null);n.options.__file="request.md";a["default"]=n.exports}}]);